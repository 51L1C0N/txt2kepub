name: Txt2Kepub Auto Converter

# 觸發條件
on:
  # 1. 定時觸發 (每 30 分鐘執行一次)
  schedule:
    - cron: '0 0 * * *'
  # 2. 手動觸發 (在 Actions 頁面會有一個按鈕)
  workflow_dispatch:

jobs:
  convert-and-sync:
    runs-on: ubuntu-latest
    
    steps:
    # 1. 檢出代碼
    - name: Checkout code
      uses: actions/checkout@v3

    # 2. 設定 Python 環境
    - name: Set up Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    # 3. 安裝依賴庫
    - name: Install Dependencies
      run: |
        python -m pip install --upgrade pip
        pip install -r requirements.txt

    # 4. 賦予 Kepubify 執行權限 (關鍵步驟！)
    - name: Grant Permission to Kepubify
      run: chmod +x bin/kepubify

    # 5. 執行主程式
    - name: Run Converter
      env:
        # 這裡是讀取您存放在 GitHub 的鑰匙
        # 如果您堅持放在 Variables，請把 secrets. 改成 vars.
        # 但強烈建議 Secret 和 Token 用 secrets.
        DROPBOX_APP_KEY: ${{ secrets.DROPBOX_APP_KEY || vars.DROPBOX_APP_KEY }}
        DROPBOX_APP_SECRET: ${{ secrets.DROPBOX_APP_KEY || vars.DROPBOX_APP_KEY }}
        DROPBOX_REFRESH_TOKEN: ${{ secrets.DROPBOX_APP_KEY || vars.DROPBOX_APP_KEY }}
      run: python main.py
